<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>체르 갤러리</title>
<style>
  /* 기본 & 리셋 */
  * {
    box-sizing: border-box;
  }
  body {
    margin: 0 auto;
    max-width: 480px;
    font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
    line-height: 1.5;
    color: var(--text-color);
    background-color: var(--bg-color);
    -webkit-tap-highlight-color: transparent;
    min-height: 100vh;
    padding-bottom: 70px;
    transition: background-color 0.3s ease, color 0.3s ease;
  }
  body.light {
    --bg-color: #f0f2f7;
    --text-color: #222;
    --primary-color: #3366ff;
    --input-bg: #fff;
    --input-border: #c4c9dd;
    --btn-bg: linear-gradient(135deg, #3366ff, #254eda);
    --btn-hover-bg: linear-gradient(135deg, #254eda, #1e3bb3);
    --modal-bg: #fff;
    --comment-bg: #f8fbff;
    --comment-border: #d5dbed;
    --header-bg: #e6ebff;
  }
  body.dark {
    --bg-color: #12161f;
    --text-color: #eee;
    --primary-color: #5599ff;
    --input-bg: #1f2233;
    --input-border: #394165;
    --btn-bg: linear-gradient(135deg, #5599ff, #3366ff);
    --btn-hover-bg: linear-gradient(135deg, #3366ff, #254eda);
    --modal-bg: #1f2233;
    --comment-bg: #2a2e45;
    --comment-border: #394165;
    --header-bg: #1e2239;
  }

  /* 헤더 */
  header {
    position: sticky;
    top: 0;
    background: var(--header-bg);
    display: flex;
    align-items: center;
    padding: 10px 16px;
    gap: 10px;
    z-index: 150;
    border-bottom: 1px solid var(--input-border);
  }
  header h1 {
    margin: 0;
    font-weight: 700;
    font-size: 1.5rem;
    flex-grow: 1;
    user-select: none;
  }

  /* 버거 메뉴 버튼 */
  #burgerMenuBtn {
    width: 30px;
    height: 24px;
    border: none;
    background: transparent;
    cursor: pointer;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
  }
  #burgerMenuBtn span {
    display: block;
    height: 3px;
    background: var(--primary-color);
    border-radius: 2px;
  }

  /* 로그인 버튼 (버거바 옆) */
  #loginBtn {
    padding: 6px 14px;
    font-weight: 600;
    font-size: 1rem;
    border-radius: 6px;
    border: none;
    cursor: pointer;
    background: var(--btn-bg);
    color: white;
    transition: background 0.3s;
  }
  #loginBtn:hover {
    background: var(--btn-hover-bg);
  }

  /* 로그아웃 버튼 */
  #logoutBtn {
    padding: 6px 14px;
    font-weight: 600;
    font-size: 1rem;
    border-radius: 6px;
    border: none;
    cursor: pointer;
    background: var(--btn-bg);
    color: white;
    transition: background 0.3s;
    margin-left: auto;
  }
  #logoutBtn:hover {
    background: var(--btn-hover-bg);
  }

  /* 사이드 메뉴 */
  #sideMenu {
    position: fixed;
    top: 0;
    left: -240px;
    width: 220px;
    height: 100vh;
    background: var(--modal-bg);
    box-shadow: 2px 0 8px rgb(0 0 0 / 0.15);
    padding: 20px 16px;
    box-sizing: border-box;
    transition: left 0.3s ease;
    z-index: 200;
  }
  #sideMenu.open {
    left: 0;
  }
  #sideMenu ul {
    list-style: none;
    padding: 0;
    margin: 0;
  }
  #sideMenu ul li {
    margin-bottom: 12px;
  }
  #sideMenu ul li button {
    width: 100%;
    padding: 10px;
    border: none;
    border-radius: 6px;
    background: var(--btn-bg);
    color: white;
    font-weight: 600;
    cursor: pointer;
    transition: background 0.3s;
  }
  #sideMenu ul li button:hover {
    background: var(--btn-hover-bg);
  }

  /* 메인 영역 */
  main {
    padding: 10px 16px 70px;
  }

  /* 검색창 */
  #searchSection {
    margin-bottom: 12px;
    display: flex;
    gap: 8px;
  }
  #searchInput {
    flex-grow: 1;
    padding: 10px 14px;
    font-size: 1rem;
    border-radius: 8px;
    border: 1.5px solid var(--input-border);
    background: var(--input-bg);
    color: var(--text-color);
    outline-offset: 2px;
  }
  #searchBtn {
    padding: 10px 16px;
    font-weight: 600;
    border-radius: 8px;
    border: none;
    background: var(--btn-bg);
    color: white;
    cursor: pointer;
    transition: background 0.3s;
  }
  #searchBtn:hover {
    background: var(--btn-hover-bg);
  }

  /* 카테고리 선택 */
  #categorySelect {
    width: 100%;
    padding: 8px 12px;
    font-size: 1rem;
    margin-bottom: 14px;
    border-radius: 8px;
    border: 1.5px solid var(--input-border);
    background: var(--input-bg);
    color: var(--text-color);
  }

  /* 게시글 리스트 */
  #postList {
    list-style: none;
    padding: 0;
    margin: 0;
  }
  #postList li {
    padding: 12px 16px;
    border-radius: 10px;
    background: var(--comment-bg);
    border: 1.5px solid var(--comment-border);
    margin-bottom: 12px;
    cursor: pointer;
    font-weight: 600;
    display: flex;
    flex-direction: column;
    transition: background 0.2s, color 0.2s;
  }
  #postList li:hover {
    background: var(--primary-color);
    color: white;
  }
  #postList li .post-title {
    font-weight: 700;
    font-size: 1.1rem;
    margin-bottom: 6px;
  }
  #postList li .post-preview {
    font-weight: 400;
    font-size: 0.9rem;
    color: #666;
  }

  /* 게시글 상세 */
  #postDetail {
    display: none;
    margin-top: 20px;
  }
  #postDetail h3 {
    margin-top: 0;
    font-weight: 700;
  }
  #postDetail .post-meta {
    font-size: 0.85rem;
    color: #777;
    margin-bottom: 12px;
  }
  #postContent {
    white-space: pre-wrap;
    margin-bottom: 20px;
  }
  #backToListBtn {
    background: transparent;
    border: none;
    color: var(--primary-color);
    font-weight: 600;
    cursor: pointer;
    margin-bottom: 20px;
  }
  #backToListBtn:hover {
    text-decoration: underline;
  }

  /* 게시글 작성 */
  #writePostSection {
    margin: 16px 0;
    display: none;
    background: var(--modal-bg);
    padding: 16px 20px;
    border-radius: 12px;
    box-shadow: 0 0 12px rgb(0 0 0 / 0.1);
  }
  #writePostSection input[type="text"],
  #writePostSection textarea {
    width: 100%;
    padding: 10px 14px;
    margin-bottom: 14px;
    border: 1.5px solid var(--input-border);
    border-radius: 8px;
    background: var(--input-bg);
    color: var(--text-color);
    font-size: 1rem;
    outline-offset: 2px;
    resize: vertical;
  }
  #writePostSection textarea {
    min-height: 120px;
  }
  #writePostSection .btn-group {
    display: flex;
    gap: 12px;
    justify-content: flex-end;
  }
  #writePostSection button {
    padding: 12px 24px;
    font-weight: 700;
    background: var(--btn-bg);
    color: white;
    border-radius: 8px;
    border: none;
    cursor: pointer;
    transition: background 0.3s;
    font-size: 1rem;
  }
  #writePostSection button:hover {
    background: var(--btn-hover-bg);
  }
  #writePostSection button.cancel-btn {
    background: #aaa;
    color: #222;
  }
  #writePostSection button.cancel-btn:hover {
    background: #888;
  }

  /* 댓글 섹션 */
  #commentsSection {
    margin-top: 30px;
  }
  #commentsSection h4 {
    margin-bottom: 12px;
    font-weight: 600;
  }
  #commentsList {
    list-style: none;
    padding: 0;
    margin: 0;
    max-height: 240px;
    overflow-y: auto;
  }
  #commentsList li {
    background: var(--comment-bg);
    border: 1px solid var(--comment-border);
    border-radius: 8px;
    padding: 12px 16px;
    margin-bottom: 10px;
  }
  #commentsList li .author {
    font-weight: 700;
    font-size: 0.9rem;
    margin-bottom: 6px;
  }
  #commentsList li .content {
    white-space: pre-wrap;
    font-size: 0.95rem;
  }
  #commentsList li .createdAt {
    font-size: 0.75rem;
    color: #777;
    margin-top: 6px;
  }

  /* 댓글 작성 폼 */
  #commentForm {
    display: flex;
    margin-top: 14px;
  }
  #commentInput {
    flex-grow: 1;
    padding: 10px 14px;
    border: 1.5px solid var(--input-border);
    border-radius: 8px 0 0 8px;
    font-size: 1rem;
    background: var(--input-bg);
    color: var(--text-color);
    outline-offset: 2px;
  }
  #commentSubmitBtn {
    padding: 0 20px;
    background: var(--btn-bg);
    border: none;
    color: white;
    font-weight: 700;
    border-radius: 0 8px 8px 0;
    cursor: pointer;
    transition: background 0.3s;
  }
  #commentSubmitBtn:hover {
    background: var(--btn-hover-bg);
  }

  /* 새 글 작성 버튼 - 오른쪽 하단 고정 */
  #showWritePostBtn {
    position: fixed;
    bottom: 20px;
    right: 20px;
    background: var(--btn-bg);
    border: none;
    color: white;
    padding: 14px 22px;
    font-weight: 700;
    font-size: 1.1rem;
    border-radius: 50px;
    cursor: pointer;
    box-shadow: 0 4px 12px rgb(0 0 0 / 0.2);
    transition: background 0.3s, transform 0.15s;
    z-index: 90;
  }
  #showWritePostBtn:hover {
    background: var(--btn-hover-bg);
    transform: scale(1.05);
  }
  #showWritePostBtn:active {
    transform: scale(0.95);
  }

  /* 오류 메시지 */
  .errorMsg {
    color: #e53e3e;
    font-size: 0.85rem;
    margin-bottom: 8px;
    text-align: center;
  }

</style>
</head>
<body class="light">

<header>
  <button id="burgerMenuBtn" aria-label="메뉴 열기" aria-expanded="false" aria-controls="sideMenu">
    <span></span>
    <span></span>
    <span></span>
  </button>
  <h1>체르 갤러리</h1>
  <button id="loginBtn" style="display:none;">로그인</button>
  <button id="logoutBtn" style="display:none;">로그아웃</button>
</header>

<!-- 사이드 메뉴 -->
<nav id="sideMenu" aria-hidden="true" tabindex="-1">
  <ul>
    <li><button>임시 버튼1</button></li>
    <li><button>임시 버튼2</button></li>
    <li><button>임시 버튼3</button></li>
  </ul>
</nav>

<main>
  <!-- 검색 + 카테고리 -->
  <section id="searchSection">
    <input id="searchInput" type="search" placeholder="게시물 검색" aria-label="게시물 검색" />
    <button id="searchBtn" aria-label="검색 실행">검색</button>
  </section>

  <select id="categorySelect" aria-label="카테고리 선택">
    <option value="">전체 카테고리</option>
    <option value="자유">자유</option>
    <option value="공지">공지</option>
    <option value="질문">질문</option>
  </select>

  <!-- 게시글 리스트 -->
  <ul id="postList" aria-live="polite" aria-relevant="additions"></ul>

  <!-- 게시글 상세 -->
  <article id="postDetail" tabindex="-1" aria-label="게시글 상세 보기">
    <button id="backToListBtn">&lt; 목록으로</button>
    <h3 id="postTitle"></h3>
    <div class="post-meta">작성자: <span id="postAuthor"></span> | 작성일: <span id="postDate"></span></div>
    <div id="postContent"></div>

    <!-- 댓글 섹션 -->
    <section id="commentsSection" aria-label="댓글 섹션">
      <h4>댓글</h4>
      <ul id="commentsList"></ul>
      <form id="commentForm">
        <input id="commentInput" placeholder="댓글 작성..." autocomplete="off" aria-label="댓글 내용 입력" />
        <button id="commentSubmitBtn" type="submit">등록</button>
      </form>
    </section>
  </article>

  <!-- 게시글 작성 -->
  <section id="writePostSection" aria-label="게시글 작성" style="display:none;">
    <input type="text" id="newPostTitle" placeholder="제목" aria-label="새 게시물 제목" />
    <textarea id="newPostContent" placeholder="내용" aria-label="새 게시물 내용"></textarea>
    <select id="newPostCategory" aria-label="카테고리 선택">
      <option value="자유">자유</option>
      <option value="공지">공지</option>
      <option value="질문">질문</option>
    </select>
    <div class="btn-group">
      <button id="submitPostBtn">글 작성</button>
      <button id="cancelPostBtn" class="cancel-btn">취소</button>
    </div>
  </section>
</main>

<!-- 새 글 작성 버튼 -->
<button id="showWritePostBtn" title="새 글 작성">글쓰기 ✍️</button>

<!-- 라이트/다크 모드 토글 -->
<button id="toggleThemeBtn" title="라이트 / 다크 모드 전환" style="position: fixed; top: 10px; left: 10px; z-index: 110;">🌙</button>

<script>
  const SERVER_URL = 'http://foxbox.r-e.kr'; // http 주소로 변경

  // DOM 요소
  const body = document.body;
  const toggleThemeBtn = document.getElementById('toggleThemeBtn');

  const burgerMenuBtn = document.getElementById('burgerMenuBtn');
  const sideMenu = document.getElementById('sideMenu');

  const loginBtn = document.getElementById('loginBtn');
  const logoutBtn = document.getElementById('logoutBtn');

  const searchInput = document.getElementById('searchInput');
  const searchBtn = document.getElementById('searchBtn');
  const categorySelect = document.getElementById('categorySelect');

  const postList = document.getElementById('postList');
  const postDetail = document.getElementById('postDetail');
  const postTitle = document.getElementById('postTitle');
  const postAuthor = document.getElementById('postAuthor');
  const postDate = document.getElementById('postDate');
  const postContent = document.getElementById('postContent');
  const backToListBtn = document.getElementById('backToListBtn');

  const commentsList = document.getElementById('commentsList = document.getElementById('commentsList');
const commentForm = document.getElementById('commentForm');
const commentInput = document.getElementById('commentInput');
const commentSubmitBtn = document.getElementById('commentSubmitBtn');

const writePostSection = document.getElementById('writePostSection');
const newPostTitle = document.getElementById('newPostTitle');
const newPostContent = document.getElementById('newPostContent');
const newPostCategory = document.getElementById('newPostCategory');
const submitPostBtn = document.getElementById('submitPostBtn');
const cancelPostBtn = document.getElementById('cancelPostBtn');

const showWritePostBtn = document.getElementById('showWritePostBtn');

let currentUser = null;
let currentPostId = null;
let posts = [];

// 라이트/다크 모드 초기 설정
function loadTheme() {
  const savedTheme = localStorage.getItem('theme');
  if (savedTheme === 'dark') {
    body.classList.remove('light');
    body.classList.add('dark');
    toggleThemeBtn.textContent = '☀️';
  } else {
    body.classList.remove('dark');
    body.classList.add('light');
    toggleThemeBtn.textContent = '🌙';
  }
}
loadTheme();

toggleThemeBtn.addEventListener('click', () => {
  if (body.classList.contains('light')) {
    body.classList.replace('light', 'dark');
    toggleThemeBtn.textContent = '☀️';
    localStorage.setItem('theme', 'dark');
  } else {
    body.classList.replace('dark', 'light');
    toggleThemeBtn.textContent = '🌙';
    localStorage.setItem('theme', 'light');
  }
});

// 사이드 메뉴 열기/닫기
burgerMenuBtn.addEventListener('click', () => {
  const isOpen = sideMenu.classList.toggle('open');
  burgerMenuBtn.setAttribute('aria-expanded', isOpen ? 'true' : 'false');
  sideMenu.setAttribute('aria-hidden', !isOpen);
  if (isOpen) sideMenu.focus();
});

// 로그인 상태 UI 업데이트
function updateAuthUI() {
  if (currentUser) {
    loginBtn.style.display = 'none';
    logoutBtn.style.display = 'inline-block';
  } else {
    loginBtn.style.display = 'inline-block';
    logoutBtn.style.display = 'none';
  }
}

// 로컬스토리지에 저장된 토큰 불러오기 & 사용자 정보 가져오기
function loadUserFromToken() {
  const token = localStorage.getItem('jwt_token');
  if (!token) {
    currentUser = null;
    updateAuthUI();
    return;
  }
  // 서버에 토큰 검증 요청
  fetch(`${SERVER_URL}/api/auth/me`, {
    headers: { Authorization: `Bearer ${token}` }
  })
  .then(res => {
    if (!res.ok) throw new Error('토큰 검증 실패');
    return res.json();
  })
  .then(data => {
    currentUser = data;
    updateAuthUI();
  })
  .catch(() => {
    currentUser = null;
    localStorage.removeItem('jwt_token');
    updateAuthUI();
  });
}

// 게시글 목록 불러오기
function loadPosts() {
  const category = categorySelect.value;
  const keyword = searchInput.value.trim();
  let url = `${SERVER_URL}/api/posts?`;
  if (category) url += `category=${encodeURIComponent(category)}&`;
  if (keyword) url += `search=${encodeURIComponent(keyword)}&`;

  fetch(url)
    .then(res => {
      if (!res.ok) throw new Error('게시글 불러오기 실패');
      return res.json();
    })
    .then(data => {
      posts = data.posts || [];
      renderPostList();
      showListView();
    })
    .catch(err => {
      alert('게시글을 불러오지 못했습니다.');
      console.error(err);
    });
}

// 게시글 리스트 렌더링
function renderPostList() {
  postList.innerHTML = '';
  if(posts.length === 0) {
    postList.innerHTML = '<li>게시글이 없습니다.</li>';
    return;
  }
  posts.forEach(post => {
    const li = document.createElement('li');
    li.tabIndex = 0;
    li.className = 'post-item';
    li.dataset.id = post.id;

    const title = document.createElement('div');
    title.className = 'post-title';
    title.textContent = `[${post.category}] ${post.title}`;

    const preview = document.createElement('div');
    preview.className = 'post-preview';
    preview.textContent = post.content.length > 60 ? post.content.slice(0, 60) + '...' : post.content;

    li.appendChild(title);
    li.appendChild(preview);

    li.addEventListener('click', () => openPostDetail(post.id));
    li.addEventListener('keypress', e => {
      if(e.key === 'Enter' || e.key === ' ') {
        e.preventDefault();
        openPostDetail(post.id);
      }
    });

    postList.appendChild(li);
  });
}

// 게시글 상세 보기
function openPostDetail(id) {
  const post = posts.find(p => p.id === id);
  if (!post) return;
  currentPostId = id;

  postTitle.textContent = `[${post.category}] ${post.title}`;
  postAuthor.textContent = post.author;
  postDate.textContent = new Date(post.createdAt).toLocaleString();
  postContent.textContent = post.content;

  loadComments(id);

  postList.style.display = 'none';
  writePostSection.style.display = 'none';
  postDetail.style.display = 'block';
  commentsSection.style.display = 'block';
  commentForm.style.display = 'flex';

  postDetail.focus();
}

// 게시글 목록으로 돌아가기
backToListBtn.addEventListener('click', () => {
  currentPostId = null;
  postDetail.style.display = 'none';
  commentsSection.style.display = 'none';
  commentForm.style.display = 'none';
  postList.style.display = 'block';
  writePostSection.style.display = 'none';
});

// 댓글 불러오기
function loadComments(postId) {
  commentsList.innerHTML = '<li>댓글 불러오는 중...</li>';
  fetch(`${SERVER_URL}/api/posts/${postId}/comments`)
    .then(res => {
      if (!res.ok) throw new Error('댓글 불러오기 실패');
      return res.json();
    })
    .then(data => {
      renderComments(data.comments || []);
    })
    .catch(err => {
      commentsList.innerHTML = '<li>댓글을 불러오지 못했습니다.</li>';
      console.error(err);
    });
}

// 댓글 렌더링
function renderComments(comments) {
  commentsList.innerHTML = '';
  if(comments.length === 0) {
    commentsList.innerHTML = '<li>댓글이 없습니다.</li>';
    return;
  }
  comments.forEach(c => {
    const li = document.createElement('li');
    const author = document.createElement('div');
    author.className = 'author';
    author.textContent = c.author;

    const content = document.createElement('div');
    content.className = 'content';
    content.textContent = c.content;

    const createdAt = document.createElement('div');
    createdAt.className = 'createdAt';
    createdAt.textContent = new Date(c.createdAt).toLocaleString();

    li.appendChild(author);
    li.appendChild(content);
    li.appendChild(createdAt);
    commentsList.appendChild(li);
  });
}

// 댓글 작성
commentForm.addEventListener('submit', e => {
  e.preventDefault();
  if (!currentUser) {
    alert('댓글 작성은 로그인 후 이용 가능합니다.');
    return;
  }
  const content = commentInput.value.trim();
  if (!content) return;
  commentSubmitBtn.disabled = true;
  fetch(`${SERVER_URL}/api/posts/${currentPostId}/comments`, {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'Authorization': `Bearer ${localStorage.getItem('jwt_token')}`
    },
    body: JSON.stringify({ content })
  })
  .then(res => {
    if (!res.ok) throw new Error('댓글 작성 실패');
    return res.json();
  })
  .then(() => {
    commentInput.value = '';
    loadComments(currentPostId);
  })
  .catch(err => {
    alert('댓글 작성 중 오류가 발생했습니다.');
    console.error(err);
  })
  .finally(() => {
    commentSubmitBtn.disabled = false;
  });
});

// 새 글 작성 UI 토글
showWritePostBtn.addEventListener('click', () => {
  if (!currentUser) {
    alert('글 작성은 로그인 후 이용 가능합니다.');
    return;
  }
  postList.style.display = 'none';
  postDetail.style.display = 'none';
  commentsSection.style.display = 'none';
  commentForm.style.display = 'none';

  writePostSection.style.display = 'block';
  clearWritePostForm();
});

// 글 작성 취소 버튼
cancelPostBtn.addEventListener('click', () => {
  writePostSection.style.display = 'none';
  postList.style.display = 'block';
  clearWritePostForm();
});

function clearWritePostForm() {
  newPostTitle.value = '';
  newPostContent.value = '';
  newPostCategory.value = '자유';
}

// 글 작성 제출
submitPostBtn.addEventListener('click', () => {
  if (!currentUser) {
    alert('글 작성은 로그인 후 이용 가능합니다.');
    return;
  }
  const title = newPostTitle.value.trim();
  const content = newPostContent.value.trim();
  const category = newPostCategory.value;

  if (!title || !content) {
    alert('제목과 내용을 모두 입력해주세요.');
    return;
  }
  submitPostBtn.disabled = true;
  fetch(`${SERVER_URL}/api/posts`, {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'Authorization': `Bearer ${localStorage.getItem('jwt_token')}`
    },
    body: JSON.stringify({ title, content, category })
  })
  .then(res => {
    if (!res.ok) throw new Error('글 작성 실패');
    return res.json();
  })
  .then(() => {
    alert('글이 성공적으로 작성되었습니다.');
    writePostSection.style.display = 'none';
    clearWritePostForm();
    loadPosts();
  })
  .catch(err => {
    alert('글 작성 중 오류가 발생했습니다.');
    console.error(err);
  })
  .finally(() => {
    submitPostBtn.disabled = false;
  });
});

// 로그인 모달 대신 간단한 prompt 이용 (실제 서비스시 모달 권장)
loginBtn.addEventListener('click', () => {
  const username = prompt('아이디를 입력하세요:');
  if (!username) return;
  const password = prompt('비밀번호를 입력하세요:');
  if (!password) return;

  loginBtn.disabled = true;
  fetch(`${SERVER_URL}/api/auth/login`, {
    method: 'POST',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify({ username, password })
  })
  .then(res => {
    if (!res.ok) throw new Error('로그인 실패');
    return res.json();
  })
  .then(data => {
    localStorage.setItem('jwt_token', data.token);
    loadUserFromToken();
    loadPosts();
  })
  .catch(() => {
    alert('로그인에 실패했습니다. 아이디와 비밀번호를 확인해주세요.');
  })
  .finally(() => {
    loginBtn.disabled = false;
  });
});

// 로그아웃 처리
logoutBtn.addEventListener('click', () => {
  localStorage.removeItem('jwt_token');
  currentUser = null;
  updateAuthUI();
  loadPosts();
});

// 검색 및 카테고리 필터 이벤트
searchBtn.addEventListener('click', () => {
  loadPosts();
});
searchInput.addEventListener('keydown', e => {
  if(e.key === 'Enter') loadPosts();
});
categorySelect.addEventListener('change', () => {
  loadPosts();
});

// 초기 데이터 로딩
loadUserFromToken();
loadPosts();

function showListView() {
  postList.style.display = 'block';
  postDetail.style.display = 'none';
  commentsSection.style.display = 'none';
  commentForm.style.display = 'none';
  writePostSection.style.display = 'none';
}
</script>
</body>
</html>

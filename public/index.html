<!DOCTYPE html>
<html lang="ko">  
<head>  
<meta charset="UTF-8" />  
<meta name="viewport" content="width=device-width, initial-scale=1" />  
<title>체르 갤러리</title>  
<style>  
  /* 기본 & 리셋 */  
  * {  
    box-sizing: border-box;  
  }  
  body {  
    margin: 0 auto;  
    max-width: 480px;  
    font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, system-ui, sans-serif;  
    line-height: 1.5;  
    color: var(--text-color);  
    background-color: var(--bg-color);  
    -webkit-tap-highlight-color: transparent;  
    min-height: 100vh;  
    padding-bottom: 70px;  
    transition: background-color 0.3s ease, color 0.3s ease;  
  }  
  body.light {  
    --bg-color: #f0f2f7;  
    --text-color: #222;  
    --primary-color: #3366ff;  
    --input-bg: #fff;  
    --input-border: #c4c9dd;  
    --btn-bg: linear-gradient(135deg, #3366ff, #254eda);  
    --btn-hover-bg: linear-gradient(135deg, #254eda, #1e3bb3);  
    --modal-bg: #fff;  
    --comment-bg: #f8fbff;  
    --comment-border: #d5dbed;  
    --header-bg: #e6ebff;  
  }  
  body.dark {  
    --bg-color: #12161f;  
    --text-color: #eee;  
    --primary-color: #5599ff;  
    --input-bg: #1f2233;  
    --input-border: #394165;  
    --btn-bg: linear-gradient(135deg, #5599ff, #3366ff);  
    --btn-hover-bg: linear-gradient(135deg, #3366ff, #254eda);  
    --modal-bg: #1f2233;  
    --comment-bg: #2a2e45;  
    --comment-border: #394165;  
    --header-bg: #1e2239;  
  }  /* 헤더 */
header {
position: sticky;
top: 0;
background: var(--header-bg);
display: flex;
align-items: center;
padding: 10px 16px;
gap: 10px;
z-index: 150;
border-bottom: 1px solid var(--input-border);
}
header h1 {
margin: 0;
font-weight: 700;
font-size: 1.5rem;
flex-grow: 1;
user-select: none;
}

/* 버거 메뉴 버튼 */
#burgerMenuBtn {
width: 30px;
height: 24px;
border: none;
background: transparent;
cursor: pointer;
display: flex;
flex-direction: column;
justify-content: space-between;
}
#burgerMenuBtn span {
display: block;
height: 3px;
background: var(--primary-color);
border-radius: 2px;
}

/* 로그인 버튼 (버거바 옆) */
#loginBtn {
padding: 6px 14px;
font-weight: 600;
font-size: 1rem;
border-radius: 6px;
border: none;
cursor: pointer;
background: var(--btn-bg);
color: white;
transition: background 0.3s;
}
#loginBtn:hover {
background: var(--btn-hover-bg);
}

/* 로그아웃 버튼 */
#logoutBtn {
padding: 6px 14px;
font-weight: 600;
font-size: 1rem;
border-radius: 6px;
border: none;
cursor: pointer;
background: var(--btn-bg);
color: white;
transition: background 0.3s;
margin-left: auto;
}
#logoutBtn:hover {
background: var(--btn-hover-bg);
}

/* 사이드 메뉴 */
#sideMenu {
position: fixed;
top: 0;
left: -240px;
width: 220px;
height: 100vh;
background: var(--modal-bg);
box-shadow: 2px 0 8px rgb(0 0 0 / 0.15);
padding: 20px 16px;
box-sizing: border-box;
transition: left 0.3s ease;
z-index: 200;
}
#sideMenu.open {
left: 0;
}
#sideMenu ul {
list-style: none;
padding: 0;
margin: 0;
}
#sideMenu ul li {
margin-bottom: 12px;
}
#sideMenu ul li button {
width: 100%;
padding: 10px;
border: none;
border-radius: 6px;
background: var(--btn-bg);
color: white;
font-weight: 600;
cursor: pointer;
transition: background 0.3s;
}
#sideMenu ul li button:hover {
background: var(--btn-hover-bg);
}

/* 메인 영역 */
main {
padding: 10px 16px 70px;
}

/* 검색창 */
#searchSection {
margin-bottom: 12px;
display: flex;
gap: 8px;
}
#searchInput {
flex-grow: 1;
padding: 10px 14px;
font-size: 1rem;
border-radius: 8px;
border: 1.5px solid var(--input-border);
background: var(--input-bg);
color: var(--text-color);
outline-offset: 2px;
}
#searchBtn {
padding: 10px 16px;
font-weight: 600;
border-radius: 8px;
border: none;
background: var(--btn-bg);
color: white;
cursor: pointer;
transition: background 0.3s;
}
#searchBtn:hover {
background: var(--btn-hover-bg);
}

/* 카테고리 선택 */
#categorySelect {
width: 100%;
padding: 8px 12px;
font-size: 1rem;
margin-bottom: 14px;
border-radius: 8px;
border: 1.5px solid var(--input-border);
background: var(--input-bg);
color: var(--text-color);
}

/* 게시글 리스트 */
#postList {
list-style: none;
padding: 0;
margin: 0;
}
#postList li {
padding: 12px 16px;
border-radius: 10px;
background: var(--comment-bg);
border: 1.5px solid var(--comment-border);
margin-bottom: 12px;
cursor: pointer;
font-weight: 600;
display: flex;
flex-direction: column;
transition: background 0.2s, color 0.2s;
}
#postList li:hover {
background: var(--primary-color);
color: white;
}
#postList li .post-title {
font-weight: 700;
font-size: 1.1rem;
margin-bottom: 6px;
}
#postList li .post-preview {
font-weight: 400;
font-size: 0.9rem;
color: #666;
}

/* 게시글 상세 */
#postDetail {
display: none;
margin-top: 20px;
}
#postDetail h3 {
margin-top: 0;
font-weight: 700;
}
#postDetail .post-meta {
font-size: 0.85rem;
color: #777;
margin-bottom: 12px;
}
#postContent {
white-space: pre-wrap;
margin-bottom: 20px;
}
#backToListBtn {
background: transparent;
border: none;
color: var(--primary-color);
font-weight: 600;
cursor: pointer;
margin-bottom: 20px;
}
#backToListBtn:hover {
text-decoration: underline;
}

/* 댓글 섹션 */
#commentsSection {
margin-top: 30px;
}
#commentsSection h4 {
margin-bottom: 12px;
font-weight: 600;
}
#commentsList {
list-style: none;
padding: 0;
margin: 0;
max-height: 240px;
overflow-y: auto;
}
#commentsList li {
background: var(--comment-bg);
border: 1px solid var(--comment-border);
border-radius: 8px;
padding: 12px 16px;
margin-bottom: 10px;
}
#commentsList li .author {
font-weight: 700;
font-size: 0.9rem;
margin-bottom: 6px;
}
#commentsList li .content {
white-space: pre-wrap;
font-size: 0.95rem;
}
#commentsList li .createdAt {
font-size: 0.75rem;
color: #777;
margin-top: 6px;
}

/* 댓글 작성 폼 */
#commentForm {
display: flex;
margin-top: 14px;
}
#commentInput {
flex-grow: 1;
padding: 10px 14px;
border: 1.5px solid var(--input-border);
border-radius: 8px 0 0 8px;
font-size: 1rem;
background: var(--input-bg);
color: var(--text-color);
outline-offset: 2px;
}
#commentSubmitBtn {
padding: 0 20px;
background: var(--btn-bg);
border: none;
color: white;
font-weight: 700;
border-radius: 0 8px 8px 0;
cursor: pointer;
transition: background 0.3s;
}
#commentSubmitBtn:hover {
background: var(--btn-hover-bg);
}

/* 새 글 작성 버튼 - 오른쪽 하단 고정 */
#showWritePostBtn {
position: fixed;
bottom: 20px;
right: 20px;
background: var(--btn-bg);
border: none;
color: white;
padding: 14px 22px;
font-weight: 700;
font-size: 1.1rem;
border-radius: 50px;
cursor: pointer;
box-shadow: 0 4px 12px rgb(0 0 0 / 0.2);
transition: background 0.3s, transform 0.15s;
z-index: 90;
}
#showWritePostBtn:hover {
background: var(--btn-hover-bg);
transform: scale(1.05);
}
#showWritePostBtn:active {
transform: scale(0.95);
}

/* 오류 메시지 */
.errorMsg {
color: #e53e3e;
font-size: 0.85rem;
margin-bottom: 8px;
text-align: center;
}

</style>  
</head>  
<body class="light">  
<header>  
  <button id="burgerMenuBtn" aria-label="메뉴 열기" aria-expanded="false" aria-controls="sideMenu">  
    <span></span>  
    <span></span>  
    <span></span>  
  </button>  
  <h1>체르 갤러리</h1>  
  <button id="loginBtn" style="display:none;">로그인</button>  
  <button id="logoutBtn" style="display:none;">로그아웃</button>  
</header>  

<!-- 사이드 메뉴 -->  
<nav id="sideMenu" aria-hidden="true" tabindex="-1">  
  <ul>  
    <li><button>임시 버튼1</button></li>  
    <li><button>임시 버튼2</button></li>  
    <li><button>임시 버튼3</button></li>  
  </ul>  
</nav>  

<main>  
  <!-- 검색 + 카테고리 -->  
  <section id="searchSection">  
    <input id="searchInput" type="search" placeholder="게시물 검색" aria-label="게시물 검색" />  
    <button id="searchBtn" aria-label="검색 실행">검색</button>  
  </section>    

  <select id="categorySelect" aria-label="카테고리 선택">  
    <option value="">전체 카테고리</option>  
    <option value="자유">자유</option>  
    <option value="공지">공지</option>  
    <option value="질문">질문</option>  
  </select>    

  <!-- 게시글 리스트 -->    
  <ul id="postList" aria-live="polite" aria-relevant="additions"></ul>    

  <!-- 게시글 상세 -->    
  <article id="postDetail" tabindex="-1" aria-label="게시글 상세 보기">  
    <button id="backToListBtn">&lt; 목록으로</button>  
    <h3 id="postTitle"></h3>  
    <div class="post-meta">작성자: <span id="postAuthor"></span> | 작성일: <span id="postDate"></span></div>  
    <div id="postContent"></div>  

    <!-- 댓글 섹션 -->  
    <section id="commentsSection" aria-label="댓글 섹션">  
      <h4>댓글</h4>  
      <ul id="commentsList"></ul>  
      <form id="commentForm">  
        <input id="commentInput" placeholder="댓글 작성..." autocomplete="off" aria-label="댓글 내용 입력" />  
        <button id="commentSubmitBtn" type="submit">등록</button>  
      </form>  
    </section>

  </article>    

  <!-- 게시글 작성 -->    
  <section id="writePostSection" aria-label="게시글 작성" style="display:none;">  
    <input type="text" id="newPostTitle" placeholder="제목" aria-label="새 게시물 제목" />  
    <textarea id="newPostContent" placeholder="내용" aria-label="새 게시물 내용"></textarea>  
    <select id="newPostCategory" aria-label="카테고리 선택">  
      <option value="자유">자유</option>  
      <option value="공지">공지</option>  
      <option value="질문">질문</option>  
    </select>  
    <div class="btn-group">  
      <button id="submitPostBtn">글 작성</button>  
      <button id="cancelPostBtn" class="cancel-btn">취소</button>  
    </div>  
  </section>  
</main>  

<!-- 새 글 작성 버튼 -->  
<button id="showWritePostBtn" title="새 글 작성">글쓰기 ✍️</button>

<!-- 라이트/다크 모드 토글 -->  
<button id="toggleThemeBtn" title="라이트 / 다크 모드 전환" style="position: fixed; top: 10px; left: 10px; z-index: 110;">🌙</button>

<script>  
  const SERVER_URL = 'http://foxbox.r-e.kr'; // http 주소로 변경  
  
  // DOM 요소  
  const body = document.body;  
  const toggleThemeBtn = document.getElementById('toggleThemeBtn');  
  
  const burgerMenuBtn = document.getElementById('burgerMenuBtn');  
  const sideMenu = document.getElementById('sideMenu');  
  
  const loginBtn = document.getElementById('loginBtn');  
  const logoutBtn = document.getElementById('logoutBtn');  
  
  const searchInput = document.getElementById('searchInput');  
  const searchBtn = document.getElementById('searchBtn');  
  const categorySelect = document.getElementById('categorySelect');  
  
  const postList = document.getElementById('postList');  
  const postDetail = document.getElementById('postDetail');  
  const postTitle = document.getElementById('postTitle');  
  const postAuthor = document.getElementById('postAuthor');  
  const postDate = document.getElementById('postDate');  
  const postContent = document.getElementById('postContent');  
  const backToListBtn = document.getElementById('backToListBtn');  
  
  // 여기 오류 수정된 부분: 변수 선언 올바르게  
  const commentsList = document.getElementById('commentsList');  
  const commentForm = document.getElementById('commentForm');  
  const commentInput = document.getElementById('commentInput');  
  const commentSubmitBtn = document.getElementById('commentSubmitBtn');  
  
  const writePostSection = document.getElementById('writePostSection');  
  const newPostTitle = document.getElementById('newPostTitle');  
  const newPostContent = document.getElementById('newPostContent');  
  const newPostCategory = document.getElementById('newPostCategory');  
  const submitPostBtn = document.getElementById('submitPostBtn');  
  const cancelPostBtn = document.getElementById('cancelPostBtn');  
  
  const showWritePostBtn = document.getElementById('showWritePostBtn');  
  
  let currentUser = null;  
  let currentPostId = null;  
  let posts = [];  
  
  // 라이트/다크 모드 초기 설정  
  function loadTheme() {  
    const savedTheme = localStorage.getItem('theme');  
    if (savedTheme === 'dark') {  
      body.classList.remove('light');  
      body.classList.add('dark');  
      toggleThemeBtn.textContent = '☀️';  
    } else {  
      body.classList.remove('dark');  
      body.classList.add('light');  
      toggleThemeBtn.textContent = '🌙';  
    }  
  }  
  loadTheme();  
  
  toggleThemeBtn.addEventListener('click', () => {  
    if (body.classList.contains('light')) {  
      body.classList.replace('light', 'dark');  
      toggleThemeBtn.textContent = '☀️';  
      localStorage.setItem('theme', 'dark');  
    } else {  
      body.classList.replace('dark', 'light');  
      toggleThemeBtn.textContent = '🌙';  
      localStorage.setItem('theme', 'light');  
    }  
  });  
  
  // 사이드 메뉴 열기/닫기  
  burgerMenuBtn.addEventListener('click', () => {  
    const isOpen = sideMenu.classList.toggle('open');  
    burgerMenuBtn.setAttribute('aria-expanded', isOpen ? 'true' : 'false');  
    sideMenu.setAttribute('aria-hidden', !isOpen);  
    if (isOpen) sideMenu.focus();  
  });  
  
  // 로그인 상태 UI 업데이트  
  function updateAuthUI() {  
    if (currentUser) {  
      loginBtn.style.display = 'none';  
      logoutBtn.style.display = 'inline-block';  
    } else {  
      loginBtn.styleloginBtn.style.display = 'inline-block';  
      logoutBtn.style.display = 'none';  
    }  
  }  
  
  // 로그인 처리 (간단 폼 팝업)  
  async function login() {  
    const username = prompt('아이디를 입력하세요');  
    if (!username) return alert('아이디를 입력해야 합니다.');  
  
    const password = prompt('비밀번호를 입력하세요');  
    if (!password) return alert('비밀번호를 입력해야 합니다.');  
  
    try {  
      const res = await fetch(`${SERVER_URL}/api/login`, {  
        method: 'POST',  
        headers: { 'Content-Type': 'application/json' },  
        body: JSON.stringify({ username, password })  
      });  
      if (!res.ok) throw new Error('로그인 실패');  
      const data = await res.json();  
      localStorage.setItem('token', data.token);  
      currentUser = username;  
      updateAuthUI();  
      alert('로그인 성공');  
      loadPosts();  
    } catch (e) {  
      alert('로그인 실패: ' + e.message);  
    }  
  }  
  
  // 로그아웃 처리  
  function logout() {  
    localStorage.removeItem('token');  
    currentUser = null;  
    updateAuthUI();  
    showPostList();  
  }  
  
  loginBtn.addEventListener('click', login);  
  logoutBtn.addEventListener('click', logout);  
  
  // 토큰 체크 및 사용자 정보 설정  
  function checkAuth() {  
    const token = localStorage.getItem('token');  
    if (token) {  
      // 실제 서버에서 토큰 확인 후 사용자 이름 받아와야 하지만 간단히 저장된 토큰 있으면 로그인 상태로 처리  
      currentUser = '사용자'; // 임시 이름  
    } else {  
      currentUser = null;  
    }  
    updateAuthUI();  
  }  
  
  // 게시글 목록 불러오기  
  async function loadPosts() {  
    try {  
      let url = `${SERVER_URL}/api/posts`;  
      const category = categorySelect.value;  
      const search = searchInput.value.trim();  
      const params = new URLSearchParams();  
      if (category) params.append('category', category);  
      if (search) params.append('search', search);  
      if ([...params].length > 0) url += `?${params.toString()}`;  
  
      const res = await fetch(url);  
      if (!res.ok) throw new Error('게시글 불러오기 실패');  
      posts = await res.json();  
      renderPostList();  
    } catch (e) {  
      alert('게시글 불러오기 실패: ' + e.message);  
    }  
  }  
  
  // 게시글 리스트 렌더링  
  function renderPostList() {  
    postList.innerHTML = '';  
    if (posts.length === 0) {  
      postList.innerHTML = '<li>게시글이 없습니다.</li>';  
      return;  
    }  
    posts.forEach(post => {  
      const li = document.createElement('li');  
      li.tabIndex = 0;  
      li.setAttribute('role', 'button');  
      li.setAttribute('aria-pressed', 'false');  
      li.innerHTML = `<div class="post-title">${post.title}</div><div class="post-preview">${post.content.substring(0, 50)}...</div>`;  
      li.addEventListener('click', () => showPostDetail(post.id));  
      li.addEventListener('keypress', e => {  
        if (e.key === 'Enter' || e.key === ' ') {  
          e.preventDefault();  
          showPostDetail(post.id);  
        }  
      });  
      postList.appendChild(li);  
    });  
  }  
  
  // 게시글 상세 보기  
  async function showPostDetail(id) {  
    const post = posts.find(p => p.id === id);  
    if (!post) return;  
    currentPostId = id;  
    postTitle.textContent = post.title;  
    postAuthor.textContent = post.author || '익명';  
    postDate.textContent = new Date(post.createdAt).toLocaleString();  
    postContent.textContent = post.content;  
  
    postList.style.display = 'none';  
    writePostSection.style.display = 'none';  
    postDetail.style.display = 'block';  
  
    await loadComments(id);  
    commentInput.value = '';  
    commentInput.disabled = !currentUser;  
    commentSubmitBtn.disabled = !currentUser;  
  
    postDetail.focus();  
  }  
  
  // 게시글 목록 보기로 전환  
  function showPostList() {  
    currentPostId = null;  
    postDetail.style.display = 'none';  
    writePostSection.style.display = 'none';  
    postList.style.display = 'block';  
  }  
  
  backToListBtn.addEventListener('click', showPostList);  
  
  // 댓글 불러오기  
  async function loadComments(postId) {  
    try {  
      const res = await fetch(`${SERVER_URL}/api/posts/${postId}/comments`);  
      if (!res.ok) throw new Error('댓글 불러오기 실패');  
      const comments = await res.json();  
  
      commentsList.innerHTML = '';  
      if (comments.length === 0) {  
        commentsList.innerHTML = '<li>댓글이 없습니다.</li>';  
        return;  
      }  
  
      comments.forEach(comment => {  
        const li = document.createElement('li');  
        li.innerHTML = `<div class="author">${comment.author || '익명'}</div><div class="content">${comment.content}</div><div class="createdAt">${new Date(comment.createdAt).toLocaleString()}</div>`;  
        commentsList.appendChild(li);  
      });  
    } catch (e) {  
      alert('댓글 불러오기 실패: ' + e.message);  
    }  
  }  
  
  // 댓글 작성  
  commentForm.addEventListener('submit', async (e) => {  
    e.preventDefault();  
    if (!currentUser) {  
      alert('로그인 후 댓글 작성이 가능합니다.');  
      return;  
    }  
    const content = commentInput.value.trim();  
    if (!content) {  
      alert('댓글 내용을 입력하세요.');  
      return;  
    }  
  
    try {  
      const token = localStorage.getItem('token');  
      const res = await fetch(`${SERVER_URL}/api/posts/${currentPostId}/comments`, {  
        method: 'POST',  
        headers: {  
          'Content-Type': 'application/json',  
          'Authorization': `Bearer ${token}`  
        },  
        body: JSON.stringify({ content })  
      });  
      if (!res.ok) throw new Error('댓글 작성 실패');  
      commentInput.value = '';  
      await loadComments(currentPostId);  
    } catch (e) {  
      alert('댓글 작성 실패: ' + e.message);  
    }  
  });  
  
  // 새 글 작성 UI 보이기  
  showWritePostBtn.addEventListener('click', () => {  
    postList.style.display = 'none';  
    postDetail.style.display = 'none';  
    writePostSection.style.display = 'block';  
    newPostTitle.value = '';  
    newPostContent.value = '';  
    newPostCategory.value = '자유';  
  });  
  
  // 새 글 작성 취소  
  cancelPostBtn.addEventListener('click', () => {  
    writePostSection.style.display = 'none';  
    showPostList();  
  });  
  
  // 새 글 작성 제출  
  submitPostBtn.addEventListener('click', async () => {  
    if (!currentUser) {  
      alert('로그인 후 글 작성이 가능합니다.');  
      return;  
    }  
    const title = newPostTitle.value.trim();  
    const content = newPostContent.value.trim();  
    const category = newPostCategory.value;  
  
    if (!title || !content) {  
      alert('제목과 내용을 모두 입력하세요.');  
      return;  
    }  
  
    try {  
      const token = localStorage.getItem('token');  
      const res = await fetch(`${SERVER_URL}/api/posts`, {  
        method: 'POST',  
        headers: {  
          'Content-Type': 'application/json',  
          'Authorization': `Bearer ${token}`  
        },  
        body: JSON.stringify({ title, content, category })  
      });  
      if (!res.ok) throw new Error('글 작성 실패');  
      alert('글이 작성되었습니다.');  
      writePostSection.style.display = 'none';  
      loadPosts();  
      showPostList();  
    } catch (e) {  
      alert('글 작성 실패: ' + e.message);  
    }  
  });  
  
  // 카테고리 선택 및 검색 버튼 이벤트  
  categorySelect.addEventListener('change', loadPosts);  
  searchBtn.addEventListener('click', loadPosts);  
  
  // 초기 실행  
  checkAuth();  
  loadPosts();  
</script>  
</body>  
</html>

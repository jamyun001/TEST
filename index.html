<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ï≤¥Î•¥ Í∞§Îü¨Î¶¨</title>
  <style>
    * {
      box-sizing: border-box;
    }
    body {
      max-width: 480px;
      margin: 0 auto;
      padding: 24px 20px 60px;
      font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
      background: #f0f2f7;
      color: #222;
      min-height: 100vh;
      position: relative;
      -webkit-tap-highlight-color: transparent;
      transition: background 0.3s, color 0.3s;
    }
    body.dark {
      background: #121212;
      color: #eee;
    }
    header {
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      margin-bottom: 28px;
    }
    header h1 {
      font-size: 2.2rem;
      font-weight: 900;
      color: #3366ff;
      margin: 0 60px;
      letter-spacing: 1.5px;
      flex-grow: 1;
      text-align: center;
    }
    header p {
      font-size: 1rem;
      color: #666;
      position: absolute;
      bottom: -20px;
      left: 50%;
      transform: translateX(-50%);
    }
    #darkModeToggle {
      position: absolute;
      left: 0;
      top: 0;
      background: transparent;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
      color: #3366ff;
      padding: 8px 12px;
      user-select: none;
      transition: color 0.3s;
    }
    #darkModeToggle:hover {
      color: #254eda;
    }
    #loginBtn, #logoutBtn {
      position: absolute;
      right: 0;
      top: 6px;
      padding: 6px 12px;
      font-weight: 700;
      font-size: 1rem;
      color: #3366ff;
      background: transparent;
      border: 2px solid #3366ff;
      border-radius: 20px;
      cursor: pointer;
      user-select: none;
      transition: background 0.3s ease, color 0.3s ease;
      margin-left: 6px;
    }
    #loginBtn:hover, #logoutBtn:hover {
      background: #3366ff;
      color: white;
    }
    #topBar {
      display: flex;
      gap: 12px;
      margin-bottom: 26px;
    }
    #searchInput {
      flex-grow: 1;
      max-width: 65%;
      padding: 14px 18px;
      border-radius: 14px;
      border: 2px solid #d0d7e9;
      font-size: 1rem;
      font-weight: 600;
      background: white;
      color: #222;
      transition: 0.3s;
    }
    body.dark #searchInput {
      background: #222;
      color: #eee;
      border-color: #555;
    }
    #searchInput:focus {
      border-color: #3366ff;
      box-shadow: 0 0 8px rgba(51,102,255,0.3);
      outline: none;
    }
    #writePostBtn {
      padding: 14px 28px;
      background: linear-gradient(135deg, #3366ff, #254eda);
      color: #fff;
      border: none;
      border-radius: 14px;
      font-weight: 800;
      font-size: 1.1rem;
      cursor: pointer;
      box-shadow: 0 8px 22px rgba(51,102,255,0.55);
      user-select: none;
      transition: background 0.3s ease;
      flex-shrink: 0;
      max-width: 35%;
    }
    #writePostBtn:disabled {
      background: #a0a7e8;
      cursor: not-allowed;
      box-shadow: none;
    }
    #writePostBtn:hover:not(:disabled) {
      background: linear-gradient(135deg, #254eda, #1e3bb3);
    }
    #writePostBtn:active:not(:disabled) {
      box-shadow: 0 4px 12px rgba(51,102,255,0.7);
    }
    #postsList {
      background: #fff;
      border-radius: 20px;
      box-shadow: 0 12px 32px rgba(0,0,0,0.07);
      padding: 20px 24px;
      max-height: 65vh;
      overflow-y: auto;
    }
    body.dark #postsList {
      background: #1e1e1e;
      box-shadow: 0 12px 32px rgba(0,0,0,0.3);
    }
    #postsList ul {
      list-style: none;
      padding: 0;
      margin: 0;
    }
    #postsList li {
      padding: 16px 14px;
      border-bottom: 1.3px solid #e6e9f8;
      cursor: pointer;
      border-radius: 14px;
      transition: background-color 0.3s ease;
      display: flex;
      flex-direction: column;
    }
    body.dark #postsList li {
      border-bottom-color: #333;
    }
    #postsList li:last-child {
      border-bottom: none;
    }
    #postsList li:hover,
    #postsList li:focus {
      background: #e8efff;
      outline: none;
    }
    body.dark #postsList li:hover,
    body.dark #postsList li:focus {
      background: #333a55;
    }
    .post-title {
      font-weight: 800;
      font-size: 1.2rem;
      color: #3366ff;
      margin-bottom: 6px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    body.dark .post-title {
      color: #6ea0ff;
    }
    .post-meta {
      font-weight: 600;
      font-size: 0.85rem;
      color: #7a8198;
      white-space: nowrap;
    }
    body.dark .post-meta {
      color: #aaa;
    }
    /* ÎåìÍ∏Ä UI ÏÉàÎ°≠Í≤å Î≥ÄÍ≤Ω */
    #commentForm {
      display: flex;
      gap: 10px;
      margin-bottom: 12px;
      flex-wrap: wrap;
      align-items: center;
    }
    #commentForm input[type="text"]#commentAuthor {
      flex: 0 0 100px;
      padding: 10px 14px;
      border-radius: 20px;
      border: 2px solid #d5dbe8;
      font-weight: 600;
      font-size: 1rem;
      background: #f5f7ff;
      color: #222;
      user-select: none;
      cursor: default;
    }
    body.dark #commentForm input[type="text"]#commentAuthor {
      background: #2b2b2b;
      color: #eee;
      border-color: #555;
    }
    #commentForm input[type="text"]#commentText {
      flex: 1 1 auto;
      padding: 12px 18px;
      border-radius: 20px;
      border: 2px solid #d5dbe8;
      font-weight: 600;
      font-size: 1rem;
      color: #222;
      background: white;
      transition: border-color 0.3s ease, box-shadow 0.3s ease;
    }
    body.dark #commentForm input[type="text"]#commentText {
      background: #222;
      color: #eee;
      border-color: #555;
    }
    #commentForm input[type="text"]#commentText:focus {
      border-color: #3366ff;
      box-shadow: 0 0 12px rgba(51,102,255,0.35);
      outline: none;
    }
    #commentForm button {
      flex: 0 0 100px;
      background: linear-gradient(135deg, #3366ff, #254eda);
      color: white;
      font-weight: 900;
      font-size: 1.1rem;
      border: none;
      border-radius: 20px;
      padding: 12px 0;
      cursor: pointer;
      box-shadow: 0 10px 28px rgba(51,102,255,0.55);
      user-select: none;
      transition: background 0.3s ease;
    }
    #commentForm button:disabled {
      background: #a0a7e8;
      cursor: not-allowed;
      box-shadow: none;
    }
    #commentForm button:hover:not(:disabled) {
      background: linear-gradient(135deg, #254eda, #1e3bb3);
    }
    #commentForm button:active:not(:disabled) {
      box-shadow: 0 5px 16px rgba(51,102,255,0.7);
    }
    #commentsList {
      max-height: 320px;
      overflow-y: auto;
      background: #f8fbff;
      border: 2px solid #d5dbed;
      border-radius: 20px;
      padding: 14px 22px;
      color: #3c475b;
      font-weight: 600;
      font-size: 1rem;
    }
    body.dark #commentsList {
      background: #222;
      border-color: #444;
      color: #ddd;
    }
    .comment-item {
      padding: 10px 12px;
      border-bottom: 1px solid #d9e0f5;
      outline: none;
      position: relative;
    }
    body.dark .comment-item {
      border-color: #444;
    }
    .comment-item:last-child {
      border-bottom: none;
    }
    .comment-author {
      font-weight: 700;
      margin-bottom: 4px;
      color: #3366ff;
    }
    body.dark .comment-author {
      color: #6ea0ff;
    }
    .comment-content {
      white-space: pre-wrap;
      margin-bottom: 4px;
    }
    .comment-date {
      font-size: 0.85rem;
      color: #999;
    }
    body.dark .comment-date {
      color: #888;
    }
    /* Î™®Îã¨ Í≥µÌÜµ */
    .modal {
      position: fixed;
      inset: 0;
      background: rgba(20,30,70,0.6);
      backdrop-filter: blur(6px);
      display: none;
      justify-content: center;
      align-items: center;
      padding: 20px 16px;
      z-index: 1600;
    }
    .modal.active {
      display: flex;
    }
    .modal-content {
      background: #fff;
      border-radius: 24px;
      width: 100%;
      max-width: 480px;
      max-height: 85vh;
      padding: 32px 36px 36px;
      box-shadow: 0 20px 50px rgba(0,0,0,0.15);
      overflow-y: auto;
      position: relative;
      font-size: 1rem;
      line-height: 1.5;
      font-weight: 600;
      display: flex;
      flex-direction: column;
      transition: background 0.3s, color 0.3s;
    }
    body.dark .modal-content {
      background: #222;
      color: #eee;
      box-shadow: 0 20px 50px rgba(0,0,0,0.5);
    }
    .modal-content h2 {
      font-weight: 900;
      font-size: 1.8rem;
      color: #3366ff;
      margin-bottom: 26px;
    }
    body.dark .modal-content h2 {
      color: #6ea0ff;
    }
    .modal-content input[type="text"],
    .modal-content input[type="password"],
    .modal-content textarea {
      width: 100%;
      padding: 14px 18px;
      border-radius: 18px;
      border: 2px solid #d4d9e8;
      font-size: 1rem;
      font-weight: 600;
      resize: vertical;
      transition: border-color 0.3s ease, box-shadow 0.3s ease;
      font-family: 'Pretendard', sans-serif;
      margin-bottom: 18px;
      background: white;
      color: #222;
    }
    body.dark .modal-content input[type="text"],
    body.dark .modal-content input[type="password"],
    body.dark .modal-content textarea {
      background: #222;
      color: #eee;
      border-color: #555;
    }
    .modal-content input[type="text"]:focus,
    .modal-content input[type="password"]:focus,
    .modal-content textarea:focus {
      border-color: #3366ff;
      box-shadow: 0 0 12px rgba(51,102,255,0.5);
      outline: none;
    }
    .modal-content button#submitPostBtn,
    .modal-content button#submitLoginBtn,
    .modal-content button#submitRegisterBtn {
      background: linear-gradient(135deg, #3366ff, #254eda);
      border: none;
      border-radius: 20px;
      padding: 16px 0;
      font-weight: 900;
      font-size: 1.3rem;
      color: white;
      cursor: pointer;
      box-shadow: 0 10px 28px rgba(51,102,255,0.55);
      user-select: none;
      transition: background 0.3s ease;
      margin-top: auto;
    }
    .modal-content button#submitPostBtn:disabled,
    .modal-content button#submitLoginBtn:disabled,
    .modal-content button#submitRegisterBtn:disabled {
      background: #a0a7e8;
      cursor: not-allowed;
      box-shadow: none;
    }
    .modal-content button#submitPostBtn:hover:not(:disabled),
    .modal-content button#submitLoginBtn:hover:not(:disabled),
    .modal-content button#submitRegisterBtn:hover:not(:disabled) {
      background: linear-gradient(135deg, #254eda, #1e3bb3);
    }
    .modal-content button#submitPostBtn:active:not(:disabled),
    .modal-content button#submitLoginBtn:active:not(:disabled),
    .modal-content button#submitRegisterBtn:active:not(:disabled) {
      box-shadow: 0 5px 16px rgba(51,102,255,0.7);
    }
    .modal-content .closeBtn {
      position: absolute;
      top: 14px;
      right: 18px;
      font-size: 2.6rem;
      background: transparent;
      border: none;
      color: #8c95b8;
      font-weight: 700;
      cursor: pointer;
      transition: color 0.3s ease;
      user-select: none;
    }
    .modal-content .closeBtn:hover {
      color: #3366ff;
    }
    #postDetailContent {
      white-space: pre-wrap;
      color: #404556;
      font-size: 1.15rem;
      margin-bottom: 20px;
    }
    body.dark #postDetailContent {
      color: #ccc;
    }
    /* Î°úÍ∑∏Ïù∏/ÌöåÏõêÍ∞ÄÏûÖ ÌÉ≠ UI */
    #authTabs {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-bottom: 18px;
    }
    #authTabs button {
      background: transparent;
      border: none;
      font-weight: 700;
      font-size: 1.2rem;
      padding: 6px 12px;
      cursor: pointer;
      color: #666;
      border-bottom: 3px solid transparent;
      transition: color 0.3s ease, border-bottom-color 0.3s ease;
    }
    #authTabs button.active {
      color: #3366ff;
      border-bottom-color: #3366ff;
    }
  </style>
</head>
<body>
  <header>
    <button id="darkModeToggle" aria-label="Îã§ÌÅ¨ Î™®Îìú ÌÜ†Í∏Ä">üåô</button>
    <h1>Ï≤¥Î•¥ Í∞§Îü¨Î¶¨</h1>
    <p>MADE BY JAMYUN</p>
    <button id="logoutBtn" style="display:none;">Î°úÍ∑∏ÏïÑÏõÉ</button>
    <button id="loginBtn">Î°úÍ∑∏Ïù∏</button>
  </header>

  <div id="topBar">
    <input type="text" id="searchInput" placeholder="Ï†úÎ™©ÏúºÎ°ú Í≤ÄÏÉâ" aria-label="Í≤åÏãúÎ¨º Ï†úÎ™© Í≤ÄÏÉâ" />
    <button id="writePostBtn" disabled>Í∏ÄÏì∞Í∏∞</button>
  </div>

  <section id="postsList" aria-label="Í≤åÏãúÍ∏Ä Î™©Î°ù" tabindex="0">
    <ul></ul>
  </section>

  <!-- Î°úÍ∑∏Ïù∏/ÌöåÏõêÍ∞ÄÏûÖ Î™®Îã¨ -->
  <div class="modal" id="authModal" role="dialog" aria-modal="true" aria-labelledby="authModalTitle" tabindex="-1">
    <div class="modal-content">
      <button class="closeBtn" title="Îã´Í∏∞" aria-label="Îã´Í∏∞">&times;</button>
      <h2 id="authModalTitle">Î°úÍ∑∏Ïù∏</h2>
      <div id="authTabs">
        <button id="loginTab" class="active" type="button" aria-selected="true">Î°úÍ∑∏Ïù∏</button>
        <button id="registerTab" type="button" aria-selected="false">ÌöåÏõêÍ∞ÄÏûÖ</button>
      </div>
      <form id="loginForm" style="display:flex; flex-direction: column;">
        <input type="text" id="loginId" placeholder="ÏïÑÏù¥Îîî" required aria-label="ÏïÑÏù¥Îîî ÏûÖÎ†•" autocomplete="username" />
        <input type="password" id="loginPassword" placeholder="ÎπÑÎ∞ÄÎ≤àÌò∏" required autocomplete="current-password" aria-label="ÎπÑÎ∞ÄÎ≤àÌò∏ ÏûÖÎ†•" />
        <button id="submitLoginBtn" type="submit" disabled>Î°úÍ∑∏Ïù∏</button>
      </form>
      <form id="registerForm" style="display:none; flex-direction: column;">
        <input type="text" id="registerId" placeholder="ÏïÑÏù¥Îîî (ÏòÅÎ¨∏, Ïà´Ïûê 5~15Ïûê)" required aria-label="ÏïÑÏù¥Îîî ÏûÖÎ†•" autocomplete="username" />
        <input type="password" id="registerPassword" placeholder="ÎπÑÎ∞ÄÎ≤àÌò∏ (8~20Ïûê)" required aria-label="ÎπÑÎ∞ÄÎ≤àÌò∏ ÏûÖÎ†•" autocomplete="new-password" />
        <input type="password" id="registerPasswordConfirm" placeholder="ÎπÑÎ∞ÄÎ≤àÌò∏ ÌôïÏù∏" required aria-label="ÎπÑÎ∞ÄÎ≤àÌò∏ ÌôïÏù∏ ÏûÖÎ†•" autocomplete="new-password" />
        <button id="submitRegisterBtn" type="submit" disabled>ÌöåÏõêÍ∞ÄÏûÖ</button>
      </form>
    </div>
  </div>

  <!-- Í∏ÄÏì∞Í∏∞ Î™®Îã¨ -->
  <div class="modal" id="writePostModal" role="dialog" aria-modal="true" aria-labelledby="writePostTitle" tabindex="-1">
    <div class="modal-content">
      <button class="closeBtn" title="Îã´Í∏∞" aria-label="Îã´Í∏∞">&times;</button>
      <h2 id="writePostTitle">ÏÉà Í∏Ä ÏûëÏÑ±</h2>
      <form id="writePostForm" style="display:flex; flex-direction: column;">
        <input type="text" id="postTitle" placeholder="Ï†úÎ™© (5~30Ïûê)" required aria-label="Í≤åÏãúÎ¨º Ï†úÎ™© ÏûÖÎ†•" maxlength="30" />
        <textarea id="postContent" rows="6" placeholder="ÎÇ¥Ïö© (10~1000Ïûê)" required aria-label="Í≤åÏãúÎ¨º ÎÇ¥Ïö© ÏûÖÎ†•" maxlength="1000"></textarea>
        <button id="submitPostBtn" type="submit" disabled>ÏûëÏÑ± ÏôÑÎ£å</button>
      </form>
    </div>
  </div>

  <!-- Í≤åÏãúÎ¨º ÏÉÅÏÑ∏ Î∞è ÎåìÍ∏Ä Î™®Îã¨ -->
  <div class="modal" id="postDetailModal" role="dialog" aria-modal="true" aria-labelledby="postDetailTitle" tabindex="-1">
    <div class="modal-content" style="max-height: 90vh;">
      <button class="closeBtn" title="Îã´Í∏∞" aria-label="Îã´Í∏∞">&times;</button>
      <h2 id="postDetailTitle"></h2>
      <div id="postDetailContent"></div>

      <form id="commentForm" aria-label="ÎåìÍ∏Ä ÏûëÏÑ± Ìèº">
        <input type="text" id="commentAuthor" readonly aria-label="ÎåìÍ∏Ä ÏûëÏÑ±Ïûê" />
        <input type="text" id="commentText" placeholder="ÎåìÍ∏ÄÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî (1~200Ïûê)" maxlength="200" required aria-required="true" aria-describedby="commentHelp" />
        <button type="submit" id="submitCommentBtn" disabled>ÎåìÍ∏Ä ÏûëÏÑ±</button>
      </form>
      <div id="commentsList" tabindex="0" aria-live="polite" aria-label="ÎåìÍ∏Ä Î™©Î°ù"></div>
    </div>
  </div>

  <script>
    // Îã§ÌÅ¨Î™®Îìú ÌÜ†Í∏Ä
    const darkModeToggle = document.getElementById('darkModeToggle');
    darkModeToggle.addEventListener('click', () => {
      document.body.classList.toggle('dark');
      if(document.body.classList.contains('dark')) {
        darkModeToggle.textContent = '‚òÄÔ∏è';
      } else {
        darkModeToggle.textContent = 'üåô';
      }
      localStorage.setItem('darkMode', document.body.classList.contains('dark') ? 'on' : 'off');
    });
    // ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú Îã§ÌÅ¨Î™®Îìú Ïú†ÏßÄ
    if(localStorage.getItem('darkMode') === 'on') {
      document.body.classList.add('dark');
      darkModeToggle.textContent = '‚òÄÔ∏è';
    }

    // Î°úÍ∑∏Ïù∏/Î°úÍ∑∏ÏïÑÏõÉ Î≤ÑÌäº ÏöîÏÜå
    const loginBtn = document.getElementById('loginBtn');
    const logoutBtn = document.getElementById('logoutBtn');

    // Î°úÍ∑∏Ïù∏ Î™®Îã¨
    const authModal = document.getElementById('authModal');
    const loginForm = document.getElementById('loginForm');
    const registerForm = document.getElementById('registerForm');
    const loginTab = document.getElementById('loginTab');
    const registerTab = document.getElementById('registerTab');
    const submitLoginBtn = document.getElementById('submitLoginBtn');
    const submitRegisterBtn = document.getElementById('submitRegisterBtn');

    // Í∏ÄÏì∞Í∏∞ Î≤ÑÌäº, Î™®Îã¨
    const writePostBtn = document.getElementById('writePostBtn');
    const writePostModal = document.getElementById('writePostModal');
    const writePostForm = document.getElementById('writePostForm');
    const submitPostBtn = document.getElementById('submitPostBtn');

    // Í≤åÏãúÎ¨º Î™©Î°ù, Í≤ÄÏÉâ
    const postsListUl = document.querySelector('#postsList ul');
    const searchInput = document.getElementById('searchInput');

    // Í≤åÏãúÎ¨º ÏÉÅÏÑ∏ Î™®Îã¨ Î∞è ÎåìÍ∏Ä
    const postDetailModal = document.getElementById('postDetailModal');
    const postDetailTitle = document.getElementById('postDetailTitle');
    const postDetailContent = document.getElementById('postDetailContent');
    const commentForm = document.getElementById('commentForm');
    const commentAuthor = document.getElementById('commentAuthor');
    const commentText = document.getElementById('commentText');
    const submitCommentBtn = document.getElementById('submitCommentBtn');
    const commentsList = document.getElementById('commentsList');

    // Î°úÍ∑∏Ïù∏ ÏÉÅÌÉú Ï†ÄÏû• (Í∞ÑÎã®Ìûà localStorage ÏÇ¨Ïö©, Ïã§Ï†ú ÏÑúÎπÑÏä§Îäî JWT Îì± Ïù∏Ï¶ù ÌïÑÏöî)
    let currentUser = localStorage.getItem('currentUser') || null;
    let posts = JSON.parse(localStorage.getItem('posts') || '[]');
    let comments = JSON.parse(localStorage.getItem('comments') || '{}'); // { postId: [{author, text, date}] }
    let selectedPostId = null;

    // Ïú†Ìã∏ Ìï®Ïàò: ISO ÏãúÍ∞Ñ ‚Üí ÏùΩÍ∏∞ Ï¢ãÏùÄ Î¨∏ÏûêÏó¥ Î≥ÄÌôò
    function formatDate(dateStr) {
      const d = new Date(dateStr);
      return d.toLocaleString('ko-KR', {dateStyle:'short', timeStyle:'short'});
    }

    // Î°úÍ∑∏Ïù∏/Î°úÍ∑∏ÏïÑÏõÉ UI ÏóÖÎç∞Ïù¥Ìä∏
    function updateAuthUI() {
      if(currentUser) {
        loginBtn.style.display = 'none';
        logoutBtn.style.display = 'inline-block';
        writePostBtn.disabled = false;
        commentAuthor.value = currentUser;
      } else {
        loginBtn.style.display = 'inline-block';
        logoutBtn.style.display = 'none';
        writePostBtn.disabled = true;
        commentAuthor.value = '';
      }
    }

    // Í≤åÏãúÎ¨º Î™©Î°ù Î†åÎçîÎßÅ (Í≤ÄÏÉâÏñ¥ Ìè¨Ìï®)
    function renderPosts(searchTerm='') {
      postsListUl.innerHTML = '';
      const filtered = posts.filter(p => p.title.toLowerCase().includes(searchTerm.toLowerCase()));
      if(filtered.length === 0) {
        postsListUl.innerHTML = `<li style="padding:12px; text-align:center; color:#999;">Í≤ÄÏÉâ Í≤∞Í≥ºÍ∞Ä ÏóÜÏäµÎãàÎã§.</li>`;
        return;
      }
      filtered.forEach(post => {
        const li = document.createElement('li');
        li.tabIndex = 0;
        li.setAttribute('role', 'button');
        li.setAttribute('aria-label', `Í≤åÏãúÎ¨º Ï†úÎ™©: ${post.title}, ÏûëÏÑ±Ïùº: ${formatDate(post.createdAt)}`);
        li.innerHTML = `
          <div class="post-title">${post.title}</div>
          <div class="post-meta">${formatDate(post.createdAt)}</div>
        `;
        li.addEventListener('click', () => openPostDetail(post.id));
        li.addEventListener('keydown', e => {
          if(e.key === 'Enter' || e.key === ' ') {
            e.preventDefault();
            openPostDetail(post.id);
          }
        });
        postsListUl.appendChild(li);
      });
    }

    // Í≤åÏãúÎ¨º ÏÉÅÏÑ∏ Ïó¥Í∏∞
    function openPostDetail(postId) {
      selectedPostId = postId;
      const post = posts.find(p => p.id === postId);
      if(!post) return;
      postDetailTitle.textContent = post.title;
      postDetailContent.textContent = post.content;
      commentText.value = '';
      submitCommentBtn.disabled = true;
      renderComments(postId);
      if(!currentUser) {
        commentText.placeholder = 'Î°úÍ∑∏Ïù∏ ÌõÑ ÎåìÍ∏Ä ÏûëÏÑ±Ïù¥ Í∞ÄÎä•Ìï©ÎãàÎã§.';
        commentText.disabled = true;
        submitCommentBtn.disabled = true;
      } else {
        commentText.placeholder = 'ÎåìÍ∏ÄÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî (1~200Ïûê)';
        commentText.disabled = false;
      }
      openModal(postDetailModal);
    }

    // ÎåìÍ∏Ä Î†åÎçîÎßÅ
    function renderComments(postId) {
      commentsList.innerHTML = '';
      const list = comments[postId] || [];
      if(list.length === 0) {
        commentsList.innerHTML = '<p style="color:#999; padding:8px; text-align:center;">ÎåìÍ∏ÄÏù¥ ÏóÜÏäµÎãàÎã§.</p>';
        return;
      }
      list.forEach(c => {
        const div = document.createElement('div');
        div.className = 'comment-item';
        div.tabIndex = 0;
        div.setAttribute('aria-label', `ÎåìÍ∏Ä ÏûëÏÑ±Ïûê: ${c.author}, ÎÇ¥Ïö©: ${c.text}, ÏûëÏÑ±Ïùº: ${formatDate(c.date)}`);
        div.innerHTML = `
          <div class="comment-author">${c.author}</div>
          <div class="comment-content">${c.text}</div>
          <div class="comment-date">${formatDate(c.date)}</div>
        `;
        commentsList.appendChild(div);
      });
    }

    // Î™®Îã¨ Ïó¥Í∏∞/Îã´Í∏∞
    function openModal(modal) {
      modal.classList.add('active');
      modal.focus();
      document.body.style.overflow = 'hidden';
    }
    function closeModal(modal) {
      modal.classList.remove('active');
      document.body.style.overflow = '';
    }

    // Î°úÍ∑∏Ïù∏ Î™®Îã¨ ÌÉ≠ Ï†ÑÌôò
    loginTab.addEventListener('click', () => {
      loginTab.classList.add('active');
      loginTab.setAttribute('aria-selected', 'true');
      registerTab.classList.remove('active');
      registerTab.setAttribute('aria-selected', 'false');
      loginForm.style.display = 'flex';
      registerForm.style.display = 'none';
      authModal.querySelector('h2').textContent = 'Î°úÍ∑∏Ïù∏';
    });
    registerTab.addEventListener('click', () => {
      registerTab.classList.add('active');
      registerTab.setAttribute('aria-selected', 'true');
      loginTab.classList.remove('active');
      loginTab.setAttribute('aria-selected', 'false');
      registerForm.style.display = 'flex';
      loginForm.style.display = 'none';
      authModal.querySelector('h2').textContent = 'ÌöåÏõêÍ∞ÄÏûÖ';
    });

    // Î°úÍ∑∏Ïù∏ Î≤ÑÌäº ÌÅ¥Î¶≠ ‚Üí Î™®Îã¨ Ïó¥Í∏∞
    loginBtn.addEventListener('click', () => {
      loginTab.click();
      authModal.classList.add('active');
      authModal.focus();
    });

    // Î°úÍ∑∏ÏïÑÏõÉ
    logoutBtn.addEventListener('click', () => {
      if(confirm('Î°úÍ∑∏ÏïÑÏõÉ ÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) {
        currentUser = null;
        localStorage.removeItem('currentUser');
        updateAuthUI();
      }
    });

    // Î™®Îã¨ Îã´Í∏∞ Î≤ÑÌäºÎì§
    document.querySelectorAll('.modal .closeBtn').forEach(btn => {
      btn.addEventListener('click', () => {
        const modal = btn.closest('.modal');
        closeModal(modal);
      });
    });

    // Î°úÍ∑∏Ïù∏ Ìèº Ïú†Ìö®ÏÑ± Í≤ÄÏÇ¨
    function validateLoginForm() {
      const idVal = loginForm.loginId.value.trim();
      const pwVal = loginForm.loginPassword.value.trim();
      submitLoginBtn.disabled = !(idVal.length > 0 && pwVal.length > 0);
    }
    loginForm.loginId.addEventListener('input', validateLoginForm);
    loginForm.loginPassword.addEventListener('input', validateLoginForm);

    // ÌöåÏõêÍ∞ÄÏûÖ Ìèº Ïú†Ìö®ÏÑ± Í≤ÄÏÇ¨
    function validateRegisterForm() {
      const idVal = registerForm.registerId.value.trim();
      const pwVal = registerForm.registerPassword.value.trim();
      const pwConfirmVal = registerForm.registerPasswordConfirm.value.trim();

      const idRegex = /^[a-zA-Z0-9]{5,15}$/;
      const pwValid = pwVal.length >= 8 && pwVal.length <= 20;
      const idValid = idRegex.test(idVal);
      const pwMatch = pwVal === pwConfirmVal;

      submitRegisterBtn.disabled = !(idValid && pwValid && pwMatch);
    }
    registerForm.registerId.addEventListener('input', validateRegisterForm);
    registerForm.registerPassword.addEventListener('input', validateRegisterForm);
    registerForm.registerPasswordConfirm.addEventListener('input', validateRegisterForm);

    // Î°úÍ∑∏Ïù∏ Ï≤òÎ¶¨ (Í∞ÑÎã®Ìûà localStorageÏóê ÏÇ¨Ïö©Ïûê Ï†ïÎ≥¥ Ï†ÄÏû•, Ïã§Ï†úÎäî ÏÑúÎ≤Ñ API ÏÇ¨Ïö© ÌïÑÏöî)
    loginForm.addEventListener('submit', e => {
      e.preventDefault();
      const idVal = loginForm.loginId.value.trim();
      const pwVal = loginForm.loginPassword.value.trim();
      // Îã®Ïàú Ïù∏Ï¶ù ÏãúÎÆ¨Î†àÏù¥ÏÖò: Î°úÏª¨ ÏÇ¨Ïö©Ïûê Ï†ÄÏû•
      const users = JSON.parse(localStorage.getItem('users') || '{}');
      if(users[idVal] && users[idVal] === pwVal) {
        currentUser = idVal;
        localStorage.setItem('currentUser', currentUser);
        updateAuthUI();
        closeModal(authModal);
      } else {
        alert('ÏïÑÏù¥Îîî ÎòêÎäî ÎπÑÎ∞ÄÎ≤àÌò∏Í∞Ä Ïò¨Î∞îÎ•¥ÏßÄ ÏïäÏäµÎãàÎã§.');
      }
    });

    // ÌöåÏõêÍ∞ÄÏûÖ Ï≤òÎ¶¨
    registerForm.addEventListener('submit', e => {
      e.preventDefault();
      const idVal = registerForm.registerId.value.trim();
      const pwVal = registerForm.registerPassword.value.trim();
      const users = JSON.parse(localStorage.getItem('users') || '{}');
      if(users[idVal]) {
        alert('Ïù¥ÎØ∏ Ï°¥Ïû¨ÌïòÎäî ÏïÑÏù¥ÎîîÏûÖÎãàÎã§.');
        return;
      }
      users[idVal] = pwVal;
      localStorage.setItem('users', JSON.stringify(users));
      alert('ÌöåÏõêÍ∞ÄÏûÖ ÏÑ±Í≥µ! Î°úÍ∑∏Ïù∏ Ìï¥Ï£ºÏÑ∏Ïöî.');
      loginTab.click();
      loginForm.loginId.value = idVal;
      loginForm.loginPassword.value = '';
      validateLoginForm();
    });

    // Í∏ÄÏì∞Í∏∞ Î≤ÑÌäº ÌÅ¥Î¶≠ ‚Üí Í∏ÄÏì∞Í∏∞ Î™®Îã¨ Ïó¥Í∏∞
    writePostBtn.addEventListener('click', () => {
      writePostForm.reset();
      submitPostBtn.disabled = true;
      openModal(writePostModal);
    });

    // Í∏ÄÏì∞Í∏∞ Ìèº Ïú†Ìö®ÏÑ± Í≤ÄÏÇ¨
    function validateWritePostForm() {
      const title = writePostForm.postTitle.value.trim();
      const content = writePostForm.postContent.value.trim();
      submitPostBtn.disabled = !(title.length >= 5 && title.length <= 30 && content.length >= 10 && content.length <= 1000);
    }
    writePostForm.postTitle.addEventListener('input', validateWritePostForm);
    writePostForm.postContent.addEventListener('input', validateWritePostForm);

    // Í∏ÄÏì∞Í∏∞ Ï†úÏ∂ú Ï≤òÎ¶¨
    writePostForm.addEventListener('submit', e => {
      e.preventDefault();
      const title = writePostForm.postTitle.value.trim();
      const content = writePostForm.postContent.value.trim();
      const newPost = {
        id: Date.now().toString(),
        title,
        content,
        createdAt: new Date().toISOString(),
      };
      posts.unshift(newPost);
      localStorage.setItem('posts', JSON.stringify(posts));
      renderPosts(searchInput.value);
      closeModal(writePostModal);
    });

    // Í≤ÄÏÉâ ÏûÖÎ†• Ï≤òÎ¶¨ (Ïã§ÏãúÍ∞Ñ ÌïÑÌÑ∞ÎßÅ)
    searchInput.addEventListener('input', () => {
      renderPosts(searchInput.value);
    });

    // ÎåìÍ∏Ä ÏûÖÎ†• ÏÉÅÌÉúÏóê Îî∞Îùº Î≤ÑÌäº ÌôúÏÑ±Ìôî
    commentText.addEventListener('input', () => {
      const val = commentText.value.trim();
      submitCommentBtn.disabled = val.length === 0 || val.length > 200 || !currentUser;
    });

    // ÎåìÍ∏Ä ÏûëÏÑ± Ï≤òÎ¶¨
    commentForm.addEventListener('submit', e => {
      e.preventDefault();
      const text = commentText.value.trim();
      if(!text || !currentUser) return;
      if(!comments[selectedPostId]) comments[selectedPostId] = [];
      comments[selectedPostId].push({
        author: currentUser,
        text,
        date: new Date().toISOString(),
      });
      localStorage.setItem('comments', JSON.stringify(comments));
      commentText.value = '';
      submitCommentBtn.disabled = true;
      renderComments(selectedPostId);
    });

    // Ï¥àÍ∏∞ Î†åÎçîÎßÅ Î∞è ÏÉÅÌÉú Î∞òÏòÅ
    updateAuthUI();
    renderPosts();

  </script>
</body>
</html>
